---
layout: post
title:  "实验14"
date:   2019-07-20 18:22
categories: 《汇编语言》
tags: Assembly 王爽
author: Pythonbug
excerpt: 课后作业记录
mathjax: true
---

> 编程，以“年/月/日 时:分:秒”的格式，显示当前的日期、时间。

## 背景知识
在CMOS RAM中，存放着当前的时间：年、月、日、时、分、秒。这六个信息长度都为1个字节，存放单元为：
秒：0     分：2     时：4     日：7     月：8     年：9
这些数据都是以BCD的格式存放的
BCD码是以4位二进制数表示十进制数码的编码方法。

## 代码
```sh
;编程，以“年/月/日 时:分:秒”的格式，显示当前日期、时间
;用数据段去存从CMOS中读取的这些内容

assume cs:code
data segment
    db 9,8,7,4,2,0                  ;CMOS中的时间所在存储单元地址
    db 'yy/mm/dd HH:MI:SS'
data ends

code segment

    start:  mov ax,data
            mov ds,ax
            mov si,0
            mov bx,0
            ;段寄存器定义

            mov cx,6
            ;一共6个，年、月、日、时、分、秒

    s:      push cx
            mov al,[si]
            out 70h,al
            in al,71h           ;取的时间信息，一个字节的BCD码，存放于al中

            mov ah,al
            and ah,0fh          ;便于下面显示，高位存个位，低位存十位

            mov cl,4
            shr al,cl
            add ah,30h
            add al,30h          ;年的BCD码一个字节变成十进制ASCII码的两个字节

            mov [bx+6],ax       ;放入准备好的段中
            inc si
            add bx,3
            pop cx
            loop s

            mov ax,0b800h
            mov es,ax

            mov cx,17
            mov di,12*160+80

            mov ah,2            ;颜色为绿色
    s0:     mov al,[si]
            mov es:[di],ax
            add di,2
            inc si
            loop s0

            mov ax,4c00h
            int 21h

code ends

end start
```
